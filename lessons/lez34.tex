\lesson{34}{28/05/2020}Now we have all the ingredients to find the characteristic function (the Laplace transform) of the asset price.
\begin{proposition}
    The characteristic function of the asset price is given by
    \begin{equation}\label{characteristic-func}
        \psi_{\gamma,t}(\tau) = \exp{\Tr(A(\tau)\Sigma_t)+b(\tau)Y(t)+c(\tau)}
    \end{equation}
    where
    \begin{itemize}
        \item $A(\tau) = A_{22}(\tau)^{-1}A_{21}(\tau)$ is the solution of the Riccati matrix equation with
        \begin{equation}
            \mqty(A_{11}(\tau) & A_{12}(\tau) \\ A_{21}(\tau) & A_{22}(\tau)) = \mqty(M & -2Q^TQ \\ \tfrac{\gamma(\gamma -1)}{2}\mathds{1}_n & -(M^T+2\gamma RQ));
        \end{equation}
        \item $b(\tau) = \gamma$;
        \item $c(\tau) = \tfrac{\beta}{2}\Tr(\ln F(\tau)+(M^T+2\gamma RQ)\tau)+\gamma r\tau$, where $F$ comes from the linearization of the Riccati equation: $A=F^{-1}G$.
    \end{itemize}
\end{proposition}
\begin{proof}
    If we consider the Feynman-Kac PDE we get:
    \begin{align*}
        \pdv{\psi}{\tau} &= \left(r-\frac{1}{2}-\Tr(\Sigma)\right)\pdv{\psi}{y} + \frac{1}{2}\Tr(\Sigma)\pdv[2]{\psi}{y} + \\
        &\qquad
        + \Tr[(\beta Q^TQ + M\Sigma + \Sigma M^T)D\psi + 2\Sigma DQ^TQD\psi] + 2\Tr(\Sigma RQD)\pdv{\psi}{y}
    \end{align*}
    Substituting the candidate solution \eqref{characteristic-func} we get
    \begin{align*}
        0 &= -\Tr(\dot{A}(\tau)\Sigma) - \dot{b}(\tau)Y - \dot{c}(\tau) + \Tr\left[(\beta Q^TQ + M\Sigma + \Sigma M^T)A(\tau)\right. + \\
        &\qquad
        + \left. 2\Sigma A(\tau)Q^TQA(\tau)+2\Sigma RQA(\tau)b(\tau)\right] + \left(r-\frac{1}{2}-\Tr(\Sigma)\right)b(\tau) + \frac{1}{2}\Tr(\Sigma)b^2(\tau)
    \end{align*}
    with the boundary conditions
    \begin{align*}
        A(0) &= 0 \in M_n \\
        b(0) &= \gamma \in \mathbb{R} \\
        c(0) &= 0 \in \mathbb{R}
    \end{align*}
    By identifying the coefficients we get
    \begin{align*}
        \dot{b}(\tau) = 0 \qquad\Rightarrow\qquad b(\tau) \equiv \gamma \quad\forall t
    \end{align*}
    \begin{align*}
        \begin{cases}
            \dot{A}(\tau) = AM + (M^T+2\gamma RQ)A + 2AQ^TQA + \frac{\gamma(\gamma-1)}{2}\mathds{1}_n \\
            A(0) = 0
        \end{cases}
    \end{align*}
    \begin{equation*}
        \begin{cases}
            \dot{c}(\tau) = \Tr(\beta Q^TQA(\tau)) + \gamma r \\
            c(0) = 0
        \end{cases}
    \end{equation*}
    Then we linearize by taking $A = F^{-1}G$ and we solve the Riccati equation for $A$ and plug the result into the equation for $c$. Recalling that
    \begin{equation*}
        G = -\frac{1}{2}\left(\dot{F}+\dot{F}(M^T+2\gamma RQ)\right)(Q^TQ)^{-1}
    \end{equation*}
    we get
    \begin{equation*}
        \dot{c}(\tau) = -\frac{\beta}{2}\Tr(F^{-1}\dot{F} + M^T + 2\gamma RQ) + \gamma r
    \end{equation*}
    and integrating we get
    \begin{align*}
        c(\tau) = \frac{\beta}{2}\Tr(\ln F(\tau)+(M^T+2\gamma RQ)\tau)+\gamma r\tau.
    \end{align*}
\end{proof}
We now have a model for the underlying with the volatility driven by a matrix. What is the advantage with respect to a multi-factor Hestom model?

\subsection{Comparison between Wishard and \texorpdfstring{$A_2(3)$}{A_2(3)}-Heston model}
The $A_2(3)$-Heston model is a Heston model with three factors, with two of them positive. Let us consider the 2-Heston specification with two positive factors:
\begin{align*}
    \dd X_1 = K_1(\theta_1-X_1)\dd t + \epsilon_1\sqrt{X_1}\,\dd W_1 \\
    \dd X_2 = K_2(\theta_2 - X_2)\dd t + \epsilon_2\sqrt{X_2}\,\dd W_2
\end{align*}
and introduce the log-asset price
\begin{align*}
    \dd Y(t) &= \left(r-\frac{1}{2}(X_1+X_2)\right)\dd t + \rho_1\sqrt{X_1}\,\dd W_1 + \rho_2\sqrt{X_2}\,\dd W_2 + \\
    &\qquad
    +\sqrt{(1-\rho_1^2)X_1 + (1-\rho_2^2)X_2}\,\dd B
\end{align*}
which can be negative (conditionally gaussian). So, the starting point is a vector of three independent Brownian motions ($B, W_1, W_2$) such that if we consider the joint infinitesimal generator of the vector ($X_1, X_2, Y$) we get an affine process. Recall that the skew of the implied volatility surface is determined by the correlation
\begin{align*}
    \corr_t(\text{Noise}(\dd Y), \text{Noise}(\text{Vol}(S))) &= \frac{\expval{Y, X_1+X_2}}{\sqrt{\expval{Y}_t\expval{X_1+X_2}_t}} \\
    &=
    \frac{\rho_1\epsilon_1X_1 + \rho_2\epsilon_2X_2}{\sqrt{X_1+X_2}\sqrt{\epsilon_1X_2+\epsilon_2X_2}}
\end{align*}
The skew is stochastic but it is a deterministic function of the volatility factors $X_1, X_2$, that is of the volatility level. So, even if we have the ``illusion" of having a stochastic skew, if we fix the volatility level there is no more possibility to manage the skew, which is not very good because we want a free variable to control the skew independently of the volatility.
\begin{remark}
    If $X_2=0$ we get the classic Heston model, where
    \begin{align*}
        \text{skew} \simeq \frac{\rho_1\epsilon_1X_1}{\sqrt{X_1}\sqrt{\epsilon_1X_1}} = \text{constant}
    \end{align*}
    So in the classic 1-dimensional Heston model the skew is constant and it is directly related to the correlation. That's why the correlation basically manages the skew. However, this model is too poor if we want to take into account the variability of the skew.
\end{remark}
\begin{proposition}
    In the Wishart case
    \begin{align}
        \corr_t(\text{Noise}(S), \text{Noise}(\text{Vol}(S))) &= \frac{\Tr(R)Q\Sigma(t))}{\sqrt{\Tr(\Sigma(t))\Tr(Q^TQ\Sigma(t))}}.
    \end{align}
\end{proposition}%fine parte 1
\begin{proof}
    Let's start considering the asset noise. From the dynamics of the underlying we have
    \begin{align*}
        \frac{\dd S}{S} &= r\,\dd t + \Tr[\sqrt{\Sigma}\,\dd Z] \\
        &=
        r\,\dd t + \sqrt{\Tr(\Sigma)}\frac{\Tr[\sqrt{\Sigma}\,\dd Z]}{\sqrt{\Tr(\Sigma)}} \\
        \intertext{It can be shown that this leads to a scalar Brownian motion $b(t)$:}
        &=
        r\,\dd t + \sqrt{\Tr(\Sigma)}\,\dd b(t)
    \end{align*}
    In fact, if we denote with $e_i$ the $i$-th component of the canonical basis,
    \begin{align*}
        \dd\expval{b}_t &= \frac{1}{\Tr(\Sigma)}\sum_{i,j}\Cov(e^T_i\sqrt{\Sigma}\,\dd Z e_i, e^T_j\sqrt{\Sigma}\,\dd Z e_j) \\
        &=
        \frac{1}{\Tr(\Sigma)} \sum_{i,j}\mathbb{E}_t[e^T_i\sqrt{\Sigma}\,\dd Z e_i e^T_j\,\dd Z^T \sqrt{\Sigma} e_j] \\
        \intertext{Now, since $Z$ is a matrix BM with independent components, we have that $\dd Z e_i e^T_j\,\dd Z^T = e^T_je_i\mathds{1}_n\,\dd t$:}
        &=
        \frac{1}{\Tr(\Sigma)} \sum_{i,j} e^T_i\Sigma e_je_j^Te_i\,\dd t \\
        \intertext{Sum over $j$:}
        &=
        \frac{1}{\Tr(\Sigma)} \sum_{i} e^T_i\Sigma e_i\,\dd t \\
        &=
        \frac{\Tr(\Sigma)}{\Tr(\Sigma)}\,\dd t \\
        &=
        \dd t
    \end{align*}
    Now let's consider the noise driving the volatility ($\Tr(\Sigma(t))$):
    \begin{align*}
        \dd\Tr(\Sigma) &= (\beta\Tr(Q^TQ)+2\Tr(M\Sigma))\dd t + 2\Tr(\sqrt{\Sigma}\,\dd W Q) \\
        &=
        \dots\,\dd t + 2\sqrt{\Tr(\Sigma Q^TQ)}\frac{\Tr(\sqrt{\Sigma}\,\dd WQ)}{\sqrt{\Tr(\Sigma(t)Q^TQ)}} \\
        \intertext{We can introduce the scalar BM $v(t)$:}
        &=
        \dots\,\dd t + 2\sqrt{\Tr(\Sigma Q^TQ)}\,\dd v(t) \\
    \end{align*}
    In fact
    \begin{align*}
        \dd\expval{v}_t &= \frac{1}{\Tr(\Sigma Q^TQ)}\sum_{i,j}\mathbb{E}_t[e^T_i\sqrt{\Sigma}\,\dd WQ e_i e^T_j Q^T\,dd W^T \sqrt{\Sigma} e_j] \\
        &=
        \frac{1}{\Tr(\Sigma Q^TQ)}\sum_{i,j}e^T_i\sqrt{\Sigma}\Tr(Qe_ie_j^TQ^T)\sqrt{\Sigma}e_j\,\dd t \\
        \intertext{Since the expression inside the trace commutes, we can write $Qe_ie_j^TQ^T = e^T_jQ^TQe_i\in\mathbb{R}$. But the trace of a scalar is the scalar itself, so we can write:}
        &=
        \frac{1}{\Tr(\Sigma Q^TQ)}\sum_{i,j}e^T_i\Sigma e_j e_j^TQ^TQe_i\,\dd t \\
        \intertext{Sum over $j$:}
        &=
        \frac{1}{\Tr(\Sigma Q^TQ)} \sum_{i} e^T_i\Sigma Q^TQe_i\,\dd t \\
        &=
        \frac{\Tr(\Sigma Q^TQ)}{\Tr(\Sigma Q^TQ)}\,\dd t \\
        &=
        \dd t
    \end{align*}
    In conclusion,
    \begin{align*}
        \Cov_t(b(t),v(t)) &= \mathbb{E}_t\left[\frac{\Tr[\sqrt{\Sigma}\,\dd Z]}{\sqrt{\Tr(\Sigma)}} \frac{\Tr[\sqrt{\Sigma}\,\dd WQ]}{\sqrt{\Tr(\Sigma Q^TQ)}}\right] \\
        \intertext{Introduce $Z = WR^T + B\sqrt{\mathds{1}-RR^T}$:}
        &=
        \sum_{i,j}\frac{\mathbb{E}_t\left[e^T_i\sqrt{\Sigma}\,\dd Z e_i e^T_j Q^T\,\dd W^T\sqrt{\Sigma}e_j\right]}{\sqrt{\Tr(\Sigma)\Tr(\Sigma Q^TQ)}} \\
        \intertext{The only part of $Z$ which contributes is the one with $W$:}
        &=
        \sum_{i,j}\frac{\mathbb{E}_t\left[e^T_i\sqrt{\Sigma}\,\dd WR^T e_i e^T_j Q^T\,\dd W^T\sqrt{\Sigma}e_j\right]}{\sqrt{\Tr(\Sigma)\Tr(\Sigma Q^TQ)}} \\
        \intertext{Now, let's exploit the BM property which says that $e^T_i\,\dd WA\,\dd W^Te_i = \Tr(A)\,\dd t$:}
        &=
        \sum_{i,j}\frac{e^T_i\sqrt{\Sigma}\Tr(R^Te_ie_j^TQ^T)\sqrt{\Sigma}e_j\,\dd t}{\sqrt{\Tr(\Sigma)\Tr(\Sigma Q^TQ)}} \\
        &=
        \sum_{i,j}\frac{e^T_i\Sigma e_je_j^TQ^TR^Te_i\,\dd t}{\sqrt{\Tr(\Sigma)\Tr(\Sigma Q^TQ)}} \\
        &=
        \frac{\Tr(\Sigma Q^TR^T)}{\sqrt{\Tr(\Sigma)\Tr(\Sigma Q^TQ)}}
    \end{align*}
\end{proof}
The crucial difference is that now in the numerator we have a linear combination involving all the elements of the Wishart process, not only the positive volatility factors (diagonal elements) but also their covariance (off-diagonal elements). So, we have a dedicated factor to manage the skew.

\section{Wishart affine stochastic correlation model}
The Wishart affine stochastic correlation model (WASC) is a multiple-asset model (there are at least two risky assets). \\
Let's begin with a preliminary remind. We have seen the Heston model with two risky assets. We can write their dynamics introducing two volatility factors:
\begin{align*}
    \dd S_1 &= S_1(r\,\dd t + \sqrt{X_1(t)}\,\dd Z_1 + \sqrt{X_3(t)}\,\dd Z_3) \\
    \dd S_2 &= S_2(r\,\dd t + \sqrt{X_2(t)}\,\dd Z_1 + \sqrt{X_3(t)}\,\dd Z_3)
\end{align*}
where $X_1,X_2$ and $X_3$ are three independent (otherwise we loose affinity, i.e. analytical tractability) CIR processes. We can also introduce the leverage effect by allowing correlations between the Brownian motions $Z$ and the ones driving the CIR processes:
\begin{equation*}
    Z_i = \rho_iW_i + \sqrt{1-\rho_i^2}B_i
\end{equation*}
where $W_i$ is the Brownian motion driving $X_i$ and $B_i$ is its orthogonal part. \\
If we consider the (normalized) quadratic covariation, since all the Brownian motions are independent except for the one of $X_3$, we get
\begin{align*}
    \frac{\dd\expval{S_1,S_2}}{S_1S_2} = X_3(t) \,\dd t > 0
\end{align*}
because $X_3$ is a CIR process. This is a strong constraint, in fact it is reasonable to expect stochastic correlations among the assets. So, if we naively try to extend the Heston model to the three factors case we end up with something which is very limited, because there is this constraint on the sign of the correlation.\\
This is the preliminary remark that motivates the introduction of a more sophisticated model. The only assumption that we require is that the stochastic covariance matrix evolves according the dynamics of the Wishart process:
\begin{align}
    \dd\Sigma(t) = (\beta Q^TQ + M\Sigma + \Sigma M^T)\dd t + \sqrt{\Sigma}\,\dd WQ + Q^T\,\dd W^T\sqrt{\Sigma}
\end{align}
with $Q\in GL_n$ in order to be invertible, $\beta\ge n-1$ in order to have at least a weak solution and $M\in M^-$ in order to have stationarity. The assets evolve according a vector dynamics
\begin{equation}\label{assd}
    \dd S = \diag{S}(r\mathds{1}\,\dd t + \sqrt{\Sigma(t)}\,\dd Z(t))
\end{equation}
where $Z$ is a vector Brownian motion.
\begin{example}{2-dimensional case}{}{}
    For $n=2$ we write \eqref{assd} as
    \begin{align*}
        \dd\mqty(S_1 \\ S_2) = \mqty(S_1 & 0 \\ 0 & S_2)\left(\mqty(r\,\dd t \\ r\,\dd t) + \mqty(\sigma_{11} & \sigma_{12} \\ \sigma_{12} & \sigma_{22})\mqty(\dd Z_1 \\ \dd Z_2)\right)
    \end{align*}
\end{example}
\begin{remark}
    The dynamics of each asset is driven by only one row of $\Sigma(t)$, not by the whole matrix as in the 1-asset case considered before, where
    \begin{align}\label{stardynamics}
        \frac{\dd S}{S} = r\,\dd t + \Tr(\Sigma(t)\,\dd Z). \tag{$\star$}
    \end{align}
\end{remark}
\begin{remark}
    It is simple to extend the WASC model in order to consider the dynamics \eqref{stardynamics} for each asset. For example, by considering the projection along a certain direction:
    \begin{align*}
        \dfrac{\dd S_i}{S_i} = r\,\dd t + \Tr(A_i\sqrt{\Sigma(t)}\,\dd Z).
    \end{align*}
\end{remark}
\begin{remark}
    If we consider, in analogy with the multiple-asset Heston model, the quadratic covariation between the first two assets, we get
    \begin{align*}
        \frac{\dd\expval{S_1,S_2}}{S_1S_2} = \Sigma_12 \,dd t \gtrless 0
    \end{align*}
    so we have a stochastic correlation.
\end{remark}
\begin{remark}
    The general way to correlate the matrix BM $W$ and the vector BM $Z$ is to introduce a matrix $R_k\in M_n$ for $k=1,\dots,n$. So, in principle, there are many parameters because any element of $Z$ can be correlated with any element of $W$:
    \begin{align}
        \dd Z_k = \Tr(R_k\,\dd W^T) + \sqrt{1-\Tr(R_kR_k^T)}\,\dd B_k(t)
    \end{align}
    In other words, the element $R_k^{ij}$ plays the role of the covariation between $Z_k$ and $W_{ij}$: $R_k^{ij} \cong \expval{Z_k, W_{ij}}$.
\end{remark}
