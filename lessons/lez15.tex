\section{Multi-dimensional market}\lesson{15}{10/04/2020} % Bjork ch. 13
Let us assume that we have $n$ a priori given risky assets (“stocks”) with price processes $S_1(t),\dots,S_n(t)$ and a riskless asset with price process $S_0(t)$, which evolves according to a certain interest rate:
\begin{equation}
    \dfrac{\dd S_0(t)}{S_0(t)} = r_t\,\dd t.
\end{equation}
The entire asset price vector is denoted by $S(t)$, and in matrix notation we will write it as a column vector:
\begin{equation}
    S(t) = (S_0(t), S_1(t),\dots,S_n(t))^T.
\end{equation}
According to the B\&S model, the individual risky asset dynamics follows the equation:
\begin{equation}
    \dfrac{\dd S_i(t)}{S_i(t)} = \mu_i\,\dd t + \sum^d_{j=1}\sigma_{ij}\,\dd W_j^{\Pmeas}(t),
\end{equation}
where $W^{\Pmeas}(t)\in\mathbb{R}^d$ is a standard Brownian motion, i.e. $W_i\indep W_j$ $\forall i\ne j$. Here we assume that $r_t, \mu_i$ and $\sigma_{ij}$ are adapted processes to the corresponding filtration (that we assume generated by the Brownian motion itself). Notice that the number $n$ of assets is not necessarily equal to the number of Brownian motions $d$ driving the assets, so $\sigma:\mathbb{R}^d\to\mathbb{R}^n$.\\
Let's give an intuition of what we want to do. Consider, for example, a two assets model ($n=2$), that is a model with two risky assets and one riskless asset. Assume that $\mu,\sigma$ and $r$ are constant. The dynamics of risky assets is given by
\begin{align}\label{bm}
    \dfrac{\dd S_1(t)}{S_1(t)} &= \mu_1\,\dd t + \sum^d_{j=1}\sigma_{1j}\,\dd W_j^{\Pmeas}(t) \\
    \dfrac{\dd S_2(t)}{S_2(t)} &= \mu_2\,\dd t + \sum^d_{j=1}\sigma_{2j}\,\dd W_j^{\Pmeas}(t).
\end{align}
If $d=1$ both assets are driven by the same Brownian motion, i.e. they are perfectly correlated (the source of randomness is the same). However, if the drifts are different, there can be a potential presence of an arbitrage opportunity (we can discount with respect to the volatility and the corresponding rate of growth may be different). If $d>2$ we can always reduce the number of Brownian motions by normalizing the noise, in fact a linear combination of three Brownian motions can always be written as a combination or two or one Brownian motion(s).
\begin{example}{How to reduce the number of Brownian motions}{}{}
    If $d=2$, eq. \eqref{bm} become:
    \begin{align}
        \dfrac{\dd S_1(t)}{S_1(t)} &= \mu_1\,\dd t + \sigma_{11}\,\dd W_1^{\Pmeas}(t) + \sigma_{12}\,\dd W_2^{\Pmeas}(t) \\
        &=
        \mu_1\,\dd t + \sqrt{\sigma_{11}^2 + \sigma_{12}^2}\,\dd \widetilde{W}(t),
    \end{align}
    where
    \begin{equation}
        \widetilde{W} = \dfrac{1}{\sqrt{\sigma_{11}^2 + \sigma_{12}^2}}(\sigma_{11}W_1^{\Pmeas}(t) + \sigma_{12}W_2^{\Pmeas}(t)).
    \end{equation}
    The quadratic variation of $\widetilde{W}$ is
    \begin{equation}
        \expval{\widetilde{W}}_t = t
    \end{equation}
    and this is the proof that $\widetilde{W}$ is a true Brownian motion. So, one Brownian motion for process is enough.
\end{example}
So, we can re-write eq. \eqref{bm} as:
\begin{align}
    \dfrac{\dd S_1(t)}{S_1(t)} &= \mu_1\,\dd t + \sigma_{1}\,\dd W_1^{\Pmeas}(t) \\
    \dfrac{\dd S_2(t)}{S_2(t)} &= \mu_2\,\dd t + \sigma_{2}\,\dd W_2^{\Pmeas}(t).
\end{align}
We know that $\dd W_1^{\Pmeas}$ and $\dd W_2^{\Pmeas}$ are independent. This means that the two assets are independent, which is not a very realistic assumption -- statistically speaking. So, we have to introduce some kind of correlation.\\
Let's consider a triangular construction involving, asset after asset, a new Brownian motion:
\begin{align}
    \dfrac{\dd S_1(t)}{S_1(t)} &= \mu_1\,\dd t + \sigma_{1}\,\dd W_1^{\Pmeas}(t) \\
    \dfrac{\dd S_2(t)}{S_2(t)} &= \mu_2\,\dd t + \sigma_{2}\underbrace{(\rho\,\dd W_1^{\Pmeas}(t) + \sqrt{1-\rho^2}\,\dd W_2^{\Pmeas})}_{\expval{\cdot}_t=t}. %\\
    %\dfrac{\dd S_3(t)}{S_3(t)} &= \mu_3\,\dd t + \sigma_{3}\underbrace{(??\,\dd W_1^{\Pmeas}(t) + ??\,\dd W_2^{\Pmeas} + ??\,\dd W_3^{\Pmeas}(t))}_{\expval{\cdot}_t=t}
\end{align}
where $\rho$ represents the correlation between the two Brownian motions (i.e. between the two assets). This approach has two advantages: first, there is the possibility to decompose the matrix $\sigma$ using the Cholesky decomposition\footnote{The Cholesky decomposition of a Hermitian positive-definite matrix $A$ is a decomposition of the form
$A=LL^*$ where $L$ is a lower triangular matrix with real and positive diagonal entries, and $L^*$ denotes the conjugate transpose of $L$. Every Hermitian positive-definite matrix (and thus also every real-valued symmetric positive-definite matrix) has a unique Cholesky decomposition.}; second, it allows to introduce additional assets without affecting the evolution of the previous ones.

\subsection{Absence of arbitrage}
Recall that the absence of arbitrage is related to the existence of a probability measure $\Qmeas$ under which all the assets are martingales:
\begin{equation*}
    S^i_t e^{-\int_0^t r_s\,\dd s} = \Qmeas-martingale.
\end{equation*}
Recall also that we found that in order to go from the Brownian motion under the historical probability measure $\Pmeas$ to the one under the risk neutral probability measure $\Qmeas$ we just have to make a shift involving a finite variation process $\lambda\in\mathbb{R}^d$:
\begin{equation*}
    \dd W_t^{\Pmeas} \longrightarrow \dd W_t^{\Qmeas} + \lambda(t)\dd t.
\end{equation*}
The change of measure is related to the Girsanov theorem through the Radon-Nikodym derivative:
\begin{equation}
    \eval{\dv{\mathbb{Q}}{\mathbb{P}}}_t = \exp\left(\int^t_0 \lambda_s^T\cdot\dd W_s^{\mathbb{P}}-\dfrac{1}{2}\int^t_0 \norm{\lambda_s}^2\,\dd s\right).
\end{equation}
The fact that
\begin{equation}\label{159}
    \mu + \sigma\lambda = (r,\dots,r)^T \in \mathbb{R}^n
\end{equation}
means that, after the change of measure, the drifts $\mu_i$ are transformed into drifts which are equal to $r$ for all the components. $\mu$, $\sigma$, and $r$ are given a priori and we want to solve for $\lambda$. Therefore, for each $t$, the $n$-dimensional vector $\mu(t)-r(t)$ must be in the image of the diffusion matrix $\sigma(t)$. This leads to the following result.
\begin{proposition}
    A necessary condition for the absence of arbitrage is that
    \begin{equation}
        \mu(t) - r(t) \in \Im{\sigma}
    \end{equation}
    with probability one for each $t$.
\end{proposition}
We then have the following central result.
\begin{proposition}
    The model is generically arbitrage free (arbitrage free for every (sufficiently integrable) choice of $\mu$) if and only if, for each $t\le T$ and $\Pmeas$-a.s., the mapping
    \begin{equation}
        \sigma: \mathbb{R}^d \to \mathbb{R}^n
    \end{equation}
    is surjective, i.e. if and only if the volatility matrix $\sigma(t)$ has rank $n$.
\end{proposition}
From this result it follows that in order to have absence of arbitrage we must necessarily have $d\ge n$, i.e. we must have at least as many independent Wiener processes as the number of risky assets (as we said before).

\subsection{Completeness}
We now go on to obtain conditions for the model to be complete. In order to avoid pathological cases we assume that the model is generically arbitrage free. From the Second Fundamental Theorem \ref{secondfundth} we know that the model is complete if and only if the martingale measure is unique, so it is tempting to draw the conclusion that we have completeness if and only if equation \eqref{159} has a unique solution, i.e. if and only if the condition
\begin{equation}
    \ker(\sigma) = \{0\}
\end{equation}
is satisfied for all $t$ and with probability one. This is, however, not quite true. The reason is that, in case of a general filtered probability space, there is no guarantee that all equivalent measure transformations are of the Girsanov type above. In a general situation, where there are other sources of randomness beside the Wiener process $W$, the Girsanov transformation above will only change the measure for the Wiener process, but it will not affect the other processes. So, in the presence of jumps, we cannot replicate all the contingent claims.\\
In order to obtain sharp results we are therefore forced to make the assumption that all randomness in our model is generated by the Wiener process $W$.
\begin{theorem}
    Assume that the model is generically arbitrage free and that the filtration $\mathcal{F}$ is defined by
    \begin{equation}
        \mathcal{F}_t = \mathcal{F}_t^W,
    \end{equation}
    i.e. there are no jumps. Then, disregarding integrability problems, the market is complete if and only if $k = n$ and the volatility matrix $\sigma(t)$ is invertible, i.e. $\ker(\sigma) = \{0\}$ for each $t\le T$.
\end{theorem}
\begin{proof}
    The martingale measure is unique if and only if the solution $\lambda$ of the “martingale measure equation”
    \begin{equation*}
        \sigma\lambda=r-\mu
    \end{equation*}
    is unique, and this occurs if and only if $\sigma(t)$ is injective, which implies $d \le n$. But since we have assumed generic absence of arbitrage, we know that $n \ge d$ and that $\sigma(t)$ is surjective. Thus $d = n$ and $\sigma(t)$ is invertible. \\
    Alternatively, from the fact that $\Im{\sigma}=\mathbb{R}^n$ and $\Im{\sigma^T}=\mathbb{R}^d$ we have that
    \begin{equation*}
        \ker(\sigma) = (\Im{\sigma^T})^{\perp} = \{0\}.
    \end{equation*}
    Thus $\sigma(t)$ is invertible and $d = n$.
\end{proof}
Therefore if we want completeness the number of Brownian motions must be equal to the number of assets.

\subsection[Pricing]{The pricing problem with two risky assets in the Black \& Scholes model}
The dynamics of the assets under the neutral probability measure $\Qmeas$ is given by:
\begin{align}
    \dfrac{\dd S_1(t)}{S_1(t)} &= r\,\dd t + \sigma_{11}\,\dd W_1^{\Qmeas}(t) + \sigma_{12}\,\dd W_2^{\Qmeas}(t) \\
    \dfrac{\dd S_2(t)}{S_2(t)} &= r\,\dd t + \sigma_{21}\,\dd W_1^{\Qmeas}(t) + \sigma_{22}\,\dd W_2^{\Qmeas}(t),
\end{align}
where in the first asset we keep two Brownian motions in order to stick with the Bjork's book notation. \\
We want to price a contract which payoff $\Phi(S_1(t),S_2(t))$ depends on both assets $(S_1,S_2)$. According the risk neutral methodology, the price is given by the discounted value up to maturity of the conditional expected value of the payoff under the probability measure $\Qmeas$:
\begin{align}
    price_t &= e^{-r(T-t)}\expect_t[\Phi(S_1(t),S_2(t))] \\
    &=
    F(t,S_1,S_2),
\end{align}
where in we used the Feynman-Kac formula, as the payoff depends only on the terminal value of the underlying. $F$ solves the PDE: %S_1,S_2 = x_1,x_2
\begin{equation}\label{bspdee}
    \begin{cases}
    \pdv{F}{t} + r\left(x_1\pdv{F}{x_1} + x_2\pdv{F}{x_2}\right) + \dfrac{1}{2}\left(x_1^2\pdv[2]{F}{x_1}c_{11} + 2x_1x_2\pdv{F^2}{x_1x_2}c_{12} + x_2^2\pdv[2]{F}{x_2}c_{22}\right) - rF = 0 \\
    F(t,x_1,x_2) = \Phi(x_1(t),x_2(t)),
    \end{cases}
\end{equation}
where from the Itô's formula we have the coefficients:
\begin{equation}
    \mqty(c_{11}&c_{12}\\c_{21}&c_{22}) = \sigma\sigma^T = \mqty(\sigma_{11}&\sigma_{12}\\\sigma_{21}&\sigma_{22})\mqty(\sigma_{11}&\sigma_{21}\\\sigma_{12}&\sigma_{22}).
\end{equation}
\begin{example}{Exchange option}{}{}
    Consider an \emph{exchange option}, which gives the holder the right, but not the obligation, to exchange one $S_2$ share for one $S_1$ share at time $T$. So, the payoff is
    \begin{equation}
        \Phi(S_1(T),S_2(T)) = (S_1(T)-S_2(T))^+,
    \end{equation}
    which is similar to the call option payoff if we see $S_2$ as the strike. Very naively, we could think to apply the B\&S formula to $S_1$ with strike $S_2$:
    \begin{equation}
        price_t^{EXC} = S_1(t)\mathcal{N}(d_1) + e^{-r(T-t)}S_2(T)\mathcal{N}(d_2).
    \end{equation}
    \textbf{This is wrong}, because, at time $t$, $S_2(T)$ is not a measurable quantity. Then we could think to adapt the formula by using $S_2(t)$, but this is an arbitrary choice. Moreover, if we use this adaptation on $d_1$ or $d_2$, we have (for example for $d_1$)
    \begin{equation}
        d_1 = \dfrac{\ln\frac{S_1(t)}{S_2(t)}+\left(r+\frac{1}{2}(\sigma_{11}^2 + \sigma_{12}^2)\right)(T-t)}{\sqrt{(\sigma_{11}^2 + \sigma_{12}^2)(T-t)}},
    \end{equation}
    so the price of this option will depend only on the volatility of the first asset (there is no $\sigma_{21}$ or $\sigma_{22}$). This is not reasonable because the second asset plays a role in the price and if the two assets are strongly correlated we cannot expect the same price as if the two assets were poorly correlated or strongly anti-correlated. We need to start from scratch.\\
    Let us ask ourselves: which is the role of the correlation between $S_1$ and $S_2$? Is it possible to reduce the dimension of the problem (of the PDE)? Let's start by rewriting the payoff as
    \begin{equation}
        (S_1(T)-S_2(T))^+ = S_2(T)\left(\dfrac{S_1(T)}{S_2(T)}-1\right)^+ = F(t,x_1,x_2) \equiv x_2 G(T,z),
    \end{equation}
    where we denoted $\tfrac{x_1}{x_2}\equiv z$. In this case we obtain the payoff of a true call, $\left(\tfrac{S_1(T)}{S_2(T)}-1\right)^+$, where $K=1$. If the payoff has this property, maybe also the pricing function has it. Now we look for the PDE satisfied by $G$. We have:
    \begin{align*}
        \pdv{F}{t} &= x_2\pdv{G}{t}, \\
        \pdv{F}{x_1} &= x_2\pdv{G}{z}\dfrac{1}{x_2} = \pdv{G}{z}, \\
        \pdv{F}{x_2} &= G + x_2\pdv{G}{z}\left(-\dfrac{x_1}{x_2^2}\right) = G - \dfrac{x_1}{x_2}\pdv{G}{z}, \\
        \pdv[2]{F}{x_1} &= \dfrac{1}{x_2}\pdv[2]{G}{z}, \\
        \pdv[2]{F}{x_2} &= \cancel{\left(-\dfrac{x_1}{x_2^2 }\right)\pdv{G}{z}} - \left(\cancel{-\dfrac{x_1}{x_2^2}\pdv{G}{z}} + \left(\dfrac{x_1}{x_2} \pdv[2]{G}{z}\left(-\dfrac{x_1}{x_2^2}\right)\right)\right) = \dfrac{x_1^2}{x_2^3}\pdv[2]{G}{z}, \\
        \pdv{G}{x_1}{x_2} &= -\dfrac{x_1}{x_2^2}\pdv[2]{G}{z}.
    \end{align*}
    Substituting in eq. \eqref{bspdee} we get:
    \begin{align*}
        x_2\pdv{G}{t} &+ r\left(\hlc{mylightblue}{x_1\pdv{G}{z}} + x_2\left(\hlc{mypink}{G} \hlc{mylightblue}{- \dfrac{x_1}{x_2}\pdv{G}{z}}\right)\right) + \\
        & \qquad\qquad\qquad
        + \dfrac{1}{2}\left(\dfrac{x_1^2}{x_2}c_{11}\pdv[2]{G}{z} + 2\dfrac{x_1^2}{x_2}c_{12} + \dfrac{x_1^2}{x_2}c_{22}\pdv[2]{G}{z}\right) - \hlc{mypink}{rx_2G} = 0,
    \end{align*}
    where the highlighted terms cancel out. We are left with:
    \begin{equation*}
        x_2\pdv{G}{t} + \dfrac{1}{2}\dfrac{x_1^2}{x_2}\pdv[2]{G}{z}(c_{11}+c_{22}-2c_{12}) = 0.
    \end{equation*}
    Finally, by dividing by $x_2$, we get:
    \begin{equation}
        \begin{cases}
        \pdv{G}{t} + \frac{1}{2}z^2\pdv[2]{G}{z}(c_{11}+c_{22}-2c_{12}) = 0 \\
        G(T,z) = (z-1)^+.
        \end{cases}
    \end{equation}
    This is the B\&S PDE satisfied by the price of a call option with underlying $z$, interest rate $r=0$, strike $K=1$ and volatility $\sigma_z^2 = c_{11}+c_{22}-2c_{12}$. So, we can write $G$ using the B\&S formula:
    \begin{equation}
        G(t,z) = z(t)\mathcal{N}(d_1) - e^{0}1\mathcal{N}(d_2)
    \end{equation}
    and then $F = G/x_2$:
    \begin{equation}
        F(t,x_1,x_2) = x_1(t)\mathcal{N}(d_1)- x_2\mathcal{N}(d_2).
    \end{equation}
    The crucial difference between this solution and the naive one is that now the definition of $d_1$ involves the whole volatility matrix:
    \begin{align}
        \notag d_1 &= \dfrac{\ln z(t)-\frac{1}{2}\sigma_z^2(T-t)}{\sigma_z \sqrt{(T-t)}} \\
        &=
        \dfrac{\ln\frac{S_1(t)}{S_2(t)}-\frac{1}{2}(c_{11}+c_{22}-2c_{12})(T-t)}{\sqrt{(c_{11}+c_{22}-2c_{12})(T-t)}}.
    \end{align}
\end{example}
